#!/usr/bin/env bash

pushd `pwd` # store current dir
cd `dirname "$0"` # cd to script path

export NODE_ENV=test

if [ -z $DATABASE_URL ];then
  # for local tests
  export DATABASE_URL="postgres://localhost:5432/signal_boost_test"
fi

echo "----- starting app..."
cd ../
node app/index.js &

echo "----- running e2e tests..."
cd test/e2e
find . -name '*.spec.js' | xargs npx mocha -R spec -r babel-register --exit

echo "----- shutting down app..."
pkill -f 'app/index.js'

popd # return to original dir
