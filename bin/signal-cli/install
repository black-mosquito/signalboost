#!/usr/bin/env bash

cd `dirname "$0"` # cd to script path

if [ -z $SIGNAL_CLI_VERSION ];then
  echo "--- ERROR: no SIGNAL_CLI_VERSION found. try \`\$ source .env\`"
  exit 1
fi

if [ -z $CHANNEL_PHONE_NUMBER ];then
  echo "--- ERROR: no CHANNEL_PHONE_NUMBER found. try \`\$ source .env\`"
  exit 1
fi

echo "--- installing system dependencies"

sudo apt install libpq-dev libunixsocket-java

echo "--- installing signal-cli version ${version}"

wget https://github.com/AsamK/signal-cli/releases/download/v"${SIGNAL_CLI_VERSION}"/signal-cli-"${SIGNAL_CLI_VERSION}".tar.gz
sudo tar xf signal-cli-"${SIGNAL_CLI_VERSION}".tar.gz -C /opt
sudo ln -sf /opt/signal-cli-"${SIGNAL_CLI_VERSION}"/bin/signal-cli /usr/local/bin

echo "--- SUCCESS! installed signal-cli. cleaning up."

rm -rf signal-cli-"${SIGNAL_CLI_VERSION}".tar.gz
