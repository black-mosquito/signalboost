#!/usr/bin/env bash

pushd `pwd` # store current dir
cd `dirname "$0"` # cd to script path
cd ../..

sed -i -e "s|localhost|db|" ./app/config/db.json

echo "--- running tests..."

docker-compose \
  -f docker-compose-test.yml \
  run test_runner \
  /signalboost/bin/entrypoint/test-unit

echo "--- spinning down environment..."

docker-compose -f docker-compose-test.yml rm -f test_runner
docker-compose -f docker-compose-test.yml stop db
docker-compose -f docker-compose-test.yml rm -f db

popd # return to original dir
