#!/usr/bin/env bash

pushd `pwd` # store current dir
cd `dirname "$0"` # cd to script path

echo "----- setting up environment for e2e tests..."
export NODE_ENV=development

echo "----- starting app..."
cd ../../
# TODO: change this once we have a docker-compose-dev file (or even a docker-compose-e2e test? file?
docker-compose up -d

echo "----- running e2e tests..."
cd test/e2e
find . -name '*.spec.js' | xargs npx mocha -R spec -r babel-register --exit

echo "----- shutting down app..."
# TODO: change this once we have a docker-compose-dev file (or even a docker-compose-e2e test? file?
docker-compose down
docker rm -f signalboost_dispatcher_15555555555

popd # return to original dir
