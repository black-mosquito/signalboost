#!/usr/bin/env bash

pushd `pwd` # store current dir
cd `dirname "$0"` # cd to script path
cd ../.. # cd to project root

echo "--- building docker images..."

# docker build -t "signalboost:latest" .
docker build -f docker/signalboost.dockerfile -t "signalboost:latest" .
docker build -f docker/signald.dockerfile -t "signald:latest" .

echo "--- installing dependencies..."

docker-compose -f docker-compose-dev.yml \
               run --entrypoint 'yarn install' \
               api

echo "--- running migrations..."

docker-compose -f docker-compose-dev.yml \
               run --entrypoint /signalboost/bin/db/migrate \
               api

echo "--- removing db container..."

docker rm -f signalboost_db

echo "--- DONE!"

popd
